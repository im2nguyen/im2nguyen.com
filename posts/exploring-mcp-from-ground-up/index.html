<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Exploring Model Context Protocol (MCP) from the ground up | Tu's Thoughts</title>
<link rel=canonical href=http://im2nguyen.com/posts/exploring-mcp-from-ground-up/><meta name=description content="Hello! My name is Tu Nguyen, and I am a technical leader with a passion for technology and education. 

I currently help people [learn HashiCorp products](https://developer.hashicorp.com). Previously, I built engaging, interactive tutorials for [Terraform](https://developer.hashicorp.com/terraform) and [Packer](https://developer.hashicorp.com/packer), and managed the Consul Education team.  I also help advise [DreamsForSchools](https://www.dreamsforschools.org/) in designing computer science curriculums for elementary and middle school students across Southern California. 

Previously, I've led development teams in startups, and built internal DevOps tools at Optum."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="http://im2nguyen.com/posts/exploring-mcp-from-ground-up/"><meta property="og:site_name" content="Tu's Thoughts"><meta property="og:title" content="Exploring Model Context Protocol (MCP) from the ground up"><meta property="og:description" content="Large language models (LLMs) have changed how we interact with artificial intelligence, enabling natural conversations and complex reasoning. Yet these powerful models have a fundamental limitation: they’re constrained by the context available during each interaction. Without access to real-time information, private data sources, or the ability to take actions, LLMs remain sophisticated but isolated systems.
Model context protocol (MCP) tackles this limitation by creating standardized interfaces between LLMs and external systems. Similar to how APIs transformed web development by connecting different services, MCPs create clear pathways for language models to access tools, retrieve information, and perform actions based on user requests. This standardization does more than just add convenience. By separating model providers from tool creators, MCPs foster an ecosystem where specialized capabilities can be developed independently yet work together seamlessly. This approach solves the fragmentation problem in AI tool integration, where each model provider currently uses unique and incompatible connection methods."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-16T11:31:36-08:00"><meta property="article:modified_time" content="2025-03-16T11:31:36-08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Exploring Model Context Protocol (MCP) from the ground up"><meta name=twitter:description content="Large language models (LLMs) have changed how we interact with artificial intelligence, enabling natural conversations and complex reasoning. Yet these powerful models have a fundamental limitation: they’re constrained by the context available during each interaction. Without access to real-time information, private data sources, or the ability to take actions, LLMs remain sophisticated but isolated systems.
Model context protocol (MCP) tackles this limitation by creating standardized interfaces between LLMs and external systems. Similar to how APIs transformed web development by connecting different services, MCPs create clear pathways for language models to access tools, retrieve information, and perform actions based on user requests. This standardization does more than just add convenience. By separating model providers from tool creators, MCPs foster an ecosystem where specialized capabilities can be developed independently yet work together seamlessly. This approach solves the fragmentation problem in AI tool integration, where each model provider currently uses unique and incompatible connection methods."><link rel=stylesheet href=http://im2nguyen.com/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><link rel=stylesheet href=http://im2nguyen.com/css/custom.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=http://im2nguyen.com/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=http://im2nguyen.com/posts/what-does-an-education-engineer-actually-do/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&text=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&title=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&is_video=false&description=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up&body=Check out this article: http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&title=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&title=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&name=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up&description=%3cp%3eLarge%20language%20models%20%28LLMs%29%20have%20changed%20how%20we%20interact%20with%20artificial%20intelligence%2c%20enabling%20natural%20conversations%20and%20complex%20reasoning.%20Yet%20these%20powerful%20models%20have%20a%20fundamental%20limitation%3a%20they%26rsquo%3bre%20constrained%20by%20the%20context%20available%20during%20each%20interaction.%20Without%20access%20to%20real-time%20information%2c%20private%20data%20sources%2c%20or%20the%20ability%20to%20take%20actions%2c%20LLMs%20remain%20sophisticated%20but%20isolated%20systems.%3c%2fp%3e%0a%3cp%3eModel%20context%20protocol%20%28MCP%29%20tackles%20this%20limitation%20by%20creating%20standardized%20interfaces%20between%20LLMs%20and%20external%20systems.%20Similar%20to%20how%20APIs%20transformed%20web%20development%20by%20connecting%20different%20services%2c%20MCPs%20create%20clear%20pathways%20for%20language%20models%20to%20access%20tools%2c%20retrieve%20information%2c%20and%20perform%20actions%20based%20on%20user%20requests.%20This%20standardization%20does%20more%20than%20just%20add%20convenience.%20By%20separating%20model%20providers%20from%20tool%20creators%2c%20MCPs%20foster%20an%20ecosystem%20where%20specialized%20capabilities%20can%20be%20developed%20independently%20yet%20work%20together%20seamlessly.%20This%20approach%20solves%20the%20fragmentation%20problem%20in%20AI%20tool%20integration%2c%20where%20each%20model%20provider%20currently%20uses%20unique%20and%20incompatible%20connection%20methods.%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&t=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#mcp-cli-and-mcp-servers>MCP CLI and <code>mcp-servers</code></a></li><li><a href=#part-i-what-problems-do-mcps-solve>Part I: What problems do MCPs solve?</a></li><li><a href=#part-ii-how-does-mcp-work>Part II: How does MCP work?</a><ul><li><a href=#core-components-hosts-clients-and-servers>Core components: Hosts, clients, and servers</a></li><li><a href=#server-capabilities-tools-resources-and-prompts>Server capabilities: Tools, resources, and prompts</a></li><li><a href=#how-clients-and-servers-communicate>How clients and servers communicate</a></li></ul></li><li><a href=#part-iii-how-to-implement-mcp-servers>Part III: How to implement MCP servers?</a><ul><li><a href=#create-a-stdio-server>Create a stdio server</a></li><li><a href=#create-an-sse-server>Create an SSE Server</a></li><li><a href=#sse-server-lifecycle>SSE server lifecycle</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Exploring Model Context Protocol (MCP) from the ground up</h1><div class=meta><div class=postdate><time datetime="2025-03-16 11:31:36 -0800 -0800" itemprop=datePublished>2025-03-16</time></div></div></header><div class=content itemprop=articleBody><p>Large language models (LLMs) have changed how we interact with artificial intelligence, enabling natural conversations and complex reasoning. Yet these powerful models have a fundamental limitation: they&rsquo;re constrained by the context available during each interaction. Without access to real-time information, private data sources, or the ability to take actions, LLMs remain sophisticated but isolated systems.</p><p>Model context protocol (MCP) tackles this limitation by creating standardized interfaces between LLMs and external systems. Similar to how APIs transformed web development by connecting different services, MCPs create clear pathways for language models to access tools, retrieve information, and perform actions based on user requests. This standardization does more than just add convenience. By separating model providers from tool creators, MCPs foster an ecosystem where specialized capabilities can be developed independently yet work together seamlessly. This approach solves the fragmentation problem in AI tool integration, where each model provider currently uses unique and incompatible connection methods.</p><p>This article explores both the conceptual foundations and practical implementation of MCPs, organized in three main parts:</p><ol><li><p><strong>What problems do MCPs solve?</strong> examines the practical limitations of LLMs and how MCPs address these challenges, with examples of current production implementations across various industries.</p></li><li><p><strong>How does MCP work?</strong> explores how hosts, clients, and servers work together to create flexible systems for context enrichment and tool integration, showing the building blocks of effective MCP implementations.</p></li><li><p><strong>How to implement MCP servers?</strong> provides practical guidance on transport mechanisms, security considerations, and design patterns that help build robust, production-ready MCP systems.</p></li></ol><p>Throughout this journey, each section builds on previous knowledge, showing how MCPs transform isolated language models into integrated components of sophisticated AI applications.</p><h2 id=mcp-cli-and-mcp-servers>MCP CLI and <code>mcp-servers</code></h2><p>To help make MCP concepts more concrete, I created two open-source tools: the MCP CLI (<a href=https://github.com/im2nguyen/mcp-cli><code>mcp-cli</code></a>) and several MCP server implementations (<a href=https://github.com/im2nguyen/mcp-servers><code>mcp-servers</code></a>). These MIT-licensed resources offer a hands-on way to see the concepts we&rsquo;ve discussed in action.</p><p>Using these tools is completely optional. The MCP concepts stand on their own, but seeing them in action helps bridge the gap between theory and implementation. They illustrate how clients connect to servers, how capabilities are discovered, and how the protocol&rsquo;s message format works in practice.</p><p>If you&rsquo;d like to try these tools yourself, follow these steps:</p><p>First, install the MCP CLI.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install -g @im2nguyen/mcp
</span></span></code></pre></div><p>Then, clone the <code>mcp-servers</code> repository. These servers provide different functionality such as calculator, weather, and file management capabilities. The examples in this article use the calculator and weather servers.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/im2nguyen/mcp-servers.git
</span></span></code></pre></div><p>Create a file named <code>mcp-config.json</code> in your working directory. You&rsquo;ll need to update the paths to point to where you cloned the repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;mcpServers&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;calculator&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;command&#34;</span>: <span style=color:#e6db74>&#34;node&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;args&#34;</span>: [<span style=color:#e6db74>&#34;path/to/mcp-servers/mcp-calculator-server/index.js&#34;</span>],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;stdio&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;calculator-sse&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;command&#34;</span>: <span style=color:#e6db74>&#34;node&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;args&#34;</span>: [<span style=color:#e6db74>&#34;path/to/mcp-servers/mcp-calculator-sse-server/index.js&#34;</span>],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;sse&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;url&#34;</span>: <span style=color:#e6db74>&#34;http://localhost:3000&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;weather&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;command&#34;</span>: <span style=color:#e6db74>&#34;node&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;args&#34;</span>: [<span style=color:#e6db74>&#34;path/to/mcp-servers/mcp-weather-server/build/index.js&#34;</span>],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;stdio&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;file-manager&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;command&#34;</span>: <span style=color:#e6db74>&#34;node&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;args&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;path/to/mcp-servers/mcp-file-manager-server/build/index.js&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;stdio&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Make sure to replace <code>path/to/mcp-servers</code> with the actual path where you cloned the repository.</p><p>Import the configuration.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mcp config import mcp-config.json
</span></span></code></pre></div><p>Ask a simple question using a calculator server with debug output. The debug output shows the actual message exchange between client and server, revealing the protocol in action. You&rsquo;ll see the initialization handshake, tool discovery, and the calculator tool being called.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;what is 2+2?&#34;</span> | mcp chat -s calculator
</span></span></code></pre></div><p>Throughout the rest of this article, I&rsquo;ll include code examples and command outputs from these tools to illustrate key concepts. The examples help show how abstract ideas translate into working code.</p><p>If you want to explore more deeply, you can:</p><ul><li>Examine the source code to see how components are implemented</li><li>Modify the servers to add your own tools and capabilities</li><li>Use the MCP CLI as a starting point for building your own host applications</li></ul><p>With this practical foundation established, let&rsquo;s examine the core architecture that makes MCPs work.</p><h2 id=part-i-what-problems-do-mcps-solve>Part I: What problems do MCPs solve?</h2><p>Now that we understand what Model Context Protocol is, let&rsquo;s explore the specific limitations it addresses. When deploying LLMs in real applications, developers encounter several persistent challenges that prevent these models from reaching their full potential. These aren&rsquo;t just minor inconveniences but fundamental barriers to creating truly useful AI assistants. By identifying these problems clearly, we can better appreciate how MCP&rsquo;s standardized approach offers effective solutions.</p><p>The limitations of LLMs become most apparent when we try to use them for practical applications that require up-to-date information or the ability to take actions. These constraints aren&rsquo;t just technical inconveniences—they fundamentally limit what AI systems can accomplish without additional infrastructure. MCP addresses three critical challenges that have historically constrained LLM applications.</p><ol><li><p><strong>Knowledge cutoffs</strong> represent perhaps the most visible limitation. LLMs can&rsquo;t access information beyond their training date, creating a gap between user expectations and model capabilities. When users ask about recent events or personal information, models simply don&rsquo;t have this data. While retrieval-augmented generation (RAG) systems help by finding relevant information to include in prompts, they typically lack the interactive capabilities needed for truly dynamic applications.</p><p>MCP solves this knowledge constraint by providing standardized access to external data sources through a clear protocol. Rather than trying to train models with all possible information, MCP creates pathways for retrieving specific data when needed. This shifts the paradigm from &ldquo;model as knowledge repository&rdquo; to &ldquo;model as reasoning engine with tool access,&rdquo; enabling more flexible and current responses.</p></li><li><p><strong>Tool integration fragmentation</strong> creates significant development overhead. Each AI platform implements different methods for connecting models to external tools—OpenAI has function calling, Anthropic has tool use, and other providers have their own approaches. This forces developers to create and maintain separate versions of the same functionality for different AI platforms, increasing both development work and maintenance costs.</p><p>MCP addresses this fragmentation through protocol-based standardization built on JSON-RPC 2.0. By defining consistent patterns for message exchange, capability discovery, and error handling, MCP enables capabilities to be defined once but used by any compatible model. The dynamic discovery mechanism allows models to learn available tools through a formal handshake process, eliminating hardcoded assumptions about functionality.</p></li><li><p><strong>Security concerns</strong> arise when giving language models access to external systems. Direct API access creates risks ranging from exposing sensitive data to potential system exploitation. Without standardized security boundaries, each integration requires custom safety controls, increasing the likelihood of vulnerabilities.</p><p>The MCP architecture creates natural security boundaries by clearly separating responsibilities between components. Hosts manage user interaction and LLM communication, clients maintain server connections and handle message formatting, and servers provide the actual capabilities. Each component operates within defined constraints, creating multiple layers of security and control.</p></li></ol><p>Despite being relatively new, MCP has already been adopted across diverse sectors. Organizations implement MCP servers to provide secure access to file systems, databases, and cloud storage, letting LLMs search documents and retrieve information while maintaining security controls. In development environments, MCP connections to Git repositories and issue trackers help AI assistants understand code and project status throughout the development lifecycle. Web capabilities extend LLMs beyond their training data through search connectors and browser automation, while enterprise integrations connect models to internal knowledge bases, communication platforms like Slack, and business systems like Salesforce.</p><p>These real-world applications demonstrate how MCP transforms language models from isolated systems into integrated components of sophisticated AI solutions. By providing standardized access to external capabilities, MCP enables more flexible, accurate, and useful AI applications across diverse domains, from development workflows to enterprise data management and web interactions.</p><p>The next section introduces open-source tools that demonstrate these concepts in practice, providing a concrete foundation for understanding how MCP works.</p><h2 id=part-ii-how-does-mcp-work>Part II: How does MCP work?</h2><p>The Model Context Protocol creates a structured approach to connecting language models with external capabilities. This architecture provides a flexible yet consistent framework that adapts to diverse implementation needs while maintaining compatibility across different systems. By understanding the core components and how they interact, we can see how MCP achieves its remarkable flexibility without unnecessary complexity.</p><p>Before diving into the technical details, let&rsquo;s see what MCP looks like in action. Here&rsquo;s a debug output from the MCP CLI asking a weather-related question, showing all the behind-the-scenes communication:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>❯ echo <span style=color:#e6db74>&#34;what is the weather in los angeles this week?&#34;</span> | mcp chat -s weather -d
</span></span><span style=display:flex><span>2025-03-17T04:48:37.162Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:weather: Transport created successfully
</span></span><span style=display:flex><span>2025-03-17T04:48:37.167Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:weather: Connecting to server...
</span></span><span style=display:flex><span>Calculator MCP server running on stdio
</span></span><span style=display:flex><span>2025-03-17T04:48:37.223Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:weather: Connected to server!
</span></span><span style=display:flex><span>2025-03-17T04:48:37.223Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:weather: Requesting tools list...
</span></span><span style=display:flex><span>2025-03-17T04:48:37.225Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:weather: Raw tools response: <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;tools&#34;</span>:<span style=color:#f92672>[{</span><span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;get-alerts&#34;</span>,<span style=color:#e6db74>&#34;description&#34;</span>:<span style=color:#e6db74>&#34;Get weather alerts for a state&#34;</span>,<span style=color:#e6db74>&#34;inputSchema&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;object&#34;</span>,<span style=color:#e6db74>&#34;properties&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;state&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;string&#34;</span>,<span style=color:#e6db74>&#34;minLength&#34;</span>:2,<span style=color:#e6db74>&#34;maxLength&#34;</span>:2,<span style=color:#e6db74>&#34;description&#34;</span>:<span style=color:#e6db74>&#34;Two-letter state code (e.g. CA, NY)&#34;</span><span style=color:#f92672>}}</span>,<span style=color:#e6db74>&#34;required&#34;</span>:<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;state&#34;</span><span style=color:#f92672>]</span>,<span style=color:#e6db74>&#34;additionalProperties&#34;</span>:false,<span style=color:#e6db74>&#34;</span>$schema<span style=color:#e6db74>&#34;</span>:<span style=color:#e6db74>&#34;http://json-schema.org/draft-07/schema#&#34;</span><span style=color:#f92672>}}</span>,<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;get-forecast&#34;</span>,<span style=color:#e6db74>&#34;description&#34;</span>:<span style=color:#e6db74>&#34;Get weather forecast for a location&#34;</span>,<span style=color:#e6db74>&#34;inputSchema&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;object&#34;</span>,<span style=color:#e6db74>&#34;properties&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;latitude&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;number&#34;</span>,<span style=color:#e6db74>&#34;minimum&#34;</span>:-90,<span style=color:#e6db74>&#34;maximum&#34;</span>:90,<span style=color:#e6db74>&#34;description&#34;</span>:<span style=color:#e6db74>&#34;Latitude of the location&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;longitude&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;number&#34;</span>,<span style=color:#e6db74>&#34;minimum&#34;</span>:-180,<span style=color:#e6db74>&#34;maximum&#34;</span>:180,<span style=color:#e6db74>&#34;description&#34;</span>:<span style=color:#e6db74>&#34;Longitude of the location&#34;</span><span style=color:#f92672>}}</span>,<span style=color:#e6db74>&#34;required&#34;</span>:<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;latitude&#34;</span>,<span style=color:#e6db74>&#34;longitude&#34;</span><span style=color:#f92672>]</span>,<span style=color:#e6db74>&#34;additionalProperties&#34;</span>:false,<span style=color:#e6db74>&#34;</span>$schema<span style=color:#e6db74>&#34;</span>:<span style=color:#e6db74>&#34;http://json-schema.org/draft-07/schema#&#34;</span><span style=color:#f92672>}}]}</span>
</span></span><span style=display:flex><span>2025-03-17T04:48:37.225Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:weather: Discovered <span style=color:#ae81ff>2</span> tools
</span></span><span style=display:flex><span>2025-03-17T04:48:37.225Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:weather: Available tools: get-alerts, get-forecast
</span></span><span style=display:flex><span>2025-03-17T04:48:37.225Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> host:chat: Starting chat session with server: weather
</span></span><span style=display:flex><span>2025-03-17T04:48:37.225Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> host:chat: Starting non-interactive chat session <span style=color:#f92672>(</span>piped input<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2025-03-17T04:48:37.226Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> host:chat: Processing piped query:
</span></span><span style=display:flex><span>2025-03-17T04:48:37.226Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:weather: Processing query: what is the weather in los angeles this week?
</span></span><span style=display:flex><span>2025-03-17T04:48:37.227Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:weather: Available tools:
</span></span><span style=display:flex><span>2025-03-17T04:48:39.817Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:weather: Executing tool call: get-forecast
</span></span><span style=display:flex><span>2025-03-17T04:48:39.818Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:weather: Calling tool <span style=color:#e6db74>&#34;get-forecast&#34;</span> with args:
</span></span><span style=display:flex><span>2025-03-17T04:48:40.238Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:weather: Tool result: Forecast <span style=color:#66d9ef>for</span> 34.0522, -118.2437:
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>2025-03-17T04:48:43.300Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> host:chat: Disconnecting client during shutdown
</span></span><span style=display:flex><span>2025-03-17T04:48:43.300Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:weather: Disconnecting from server
</span></span><span style=display:flex><span>2025-03-17T04:48:43.301Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:weather: Disconnected from server
</span></span><span style=display:flex><span>2025-03-17T04:48:43.301Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> host:chat: Chat session ended
</span></span></code></pre></div><p>This log captures the complete lifecycle of an MCP interaction:</p><ol><li>The <strong>host</strong> (MCP CLI) initiates the process by sending a query about LA&rsquo;s weather</li><li>The <strong>client</strong> creates a transport connection to the <strong>server</strong></li><li>After connecting, the client discovers what tools the server offers (<code>get-alerts</code> and <code>get-forecast</code>)</li><li>When processing the query, the language model decides to use the <code>get-forecast</code> tool</li><li>The client executes the tool call, the server processes it, and returns weather data</li><li>Finally, the client disconnects from the server when the interaction is complete</li></ol><p>This simple example demonstrates all three key components working together: the host managing user interaction and providing an interface, the client handling communication with the server, and the server providing specialized capabilities (weather data) that extend what the language model can do on its own.</p><p>Now that we&rsquo;ve seen MCP in action, let&rsquo;s examine each component in detail.</p><h3 id=core-components-hosts-clients-and-servers>Core components: Hosts, clients, and servers</h3><p>At the foundation of every MCP implementation are hosts, clients, and servers. Each plays a specific role in the overall architecture, creating a separation of concerns that enables modular design and flexible capability composition. This division of responsibilities creates natural boundaries for security, scaling, and development workflows.</p><p>MCP supports two distinct transport mechanisms that shape how these components interact:</p><ol><li><strong>Stdio (process-based)</strong> uses standard input/output streams for communication, with servers running as local processes spawned for each session</li><li><strong>SSE (HTTP-based)</strong> uses server-sent events over HTTP for persistent connections, with servers running as long-lived services</li></ol><p>These transport options influence how hosts manage servers and how clients establish connections. Let&rsquo;s explore how each component operates within this framework.</p><h4 id=hosts>Hosts</h4><p>Hosts serve as entry points for applications, functioning as the primary interface for users and orchestrating the overall interaction flow. Claude Desktop, Cursor, and the MCP CLI are examples of hosts, each with different user interfaces and feature sets. Hosts manage server configuration, create and coordinate clients, handle LLM selection, process user interactions, and transmit context between servers and language models.</p><p>The MCP CLI&rsquo;s <code>chat.ts</code> implementation demonstrates these host responsibilities:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// From mcp-cli/src/commands/chat.ts - Host implementation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>chatCommand</span>(<span style=color:#a6e22e>program</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Command</span>, <span style=color:#a6e22e>config</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>any</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>chat</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>program</span>
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>command</span>(<span style=color:#e6db74>&#39;chat&#39;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>description</span>(<span style=color:#e6db74>&#39;Start a chat session with an MCP server&#39;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#39;-s, --server &lt;id&gt;&#39;</span>, <span style=color:#e6db74>&#39;Specify server ID to use&#39;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#39;-p, --provider &lt;provider&gt;&#39;</span>, <span style=color:#e6db74>&#39;LLM provider to use (anthropic or openai)&#39;</span>, <span style=color:#e6db74>&#39;anthropic&#39;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#39;-m, --model &lt;model&gt;&#39;</span>, <span style=color:#e6db74>&#39;Model to use (defaults based on provider)&#39;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>action</span>(<span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>options</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// 1. Server configuration management
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mcpServers</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>serverLib</span>.<span style=color:#a6e22e>getServerConfigs</span>(<span style=color:#a6e22e>config</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>serverConfig</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mcpServers</span>[<span style=color:#a6e22e>serverId</span>];
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isSSE</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>serverConfig</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;sse&#39;</span>;
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e>// 2. LLM selection and configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>model</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>model</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>provider</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;anthropic&#39;</span> <span style=color:#f92672>?</span> 
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#39;claude-3-5-sonnet-20241022&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;gpt-4o&#39;</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e>// 3. Client creation and coordination
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>McpClient</span>(<span style=color:#a6e22e>serverId</span>, <span style=color:#e6db74>`MCP Client (</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>serverId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>)`</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>llmProvider</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>provider</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>model</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>model</span>
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Connect to the server via client
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>connect</span>(<span style=color:#a6e22e>isSSE</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>serverProcess</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>, <span style=color:#a6e22e>serverConfig</span>);
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e>// 4. Processing user interactions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>processQuery</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>query</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>)<span style=color:#f92672>:</span> Promise<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>void</span><span style=color:#f92672>&gt;</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>&#39;Processing user query:&#39;</span>, <span style=color:#a6e22e>query</span>);
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#75715e>// 5. Transmitting context between servers and language models
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>processQuery</span>(<span style=color:#a6e22e>query</span>);
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>chalk</span>.<span style=color:#a6e22e>green</span>(<span style=color:#e6db74>&#39;Assistant: &#39;</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>trim</span>());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Error processing query:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>chalk</span>.<span style=color:#a6e22e>red</span>(<span style=color:#e6db74>`Error: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Set up input handling (interactive or piped)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>An important responsibility of hosts is managing servers based on their type. For stdio servers, the host spawns and terminates processes as needed. For SSE servers, the host simply connects to existing server endpoints. This flexibility allows hosts to work with both local tools and remote services using the same protocol.</p><h4 id=clients>Clients</h4><p>Clients maintain one-to-one connections with servers and handle the communication layer. Created and managed by hosts, clients translate between the host&rsquo;s needs and the server&rsquo;s capabilities. The <code>McpClient</code> class in the MCP CLI handles several key responsibilities:</p><p>The <code>connect</code> method orchestrates the connection process, creating an appropriate transport based on server type, establishing a connection, and discovering available tools. This is the entry point for client-server communication:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// From mcp-cli/src/lib/mcp-client.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#a6e22e>connect</span>(<span style=color:#a6e22e>serverProcess</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>ChildProcess</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>, <span style=color:#a6e22e>serverConfig</span><span style=color:#f92672>?:</span> <span style=color:#a6e22e>any</span>)<span style=color:#f92672>:</span> Promise<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>void</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Create and initialize the client
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Client</span>({ <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;1.0.0&#39;</span> });
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Create transport and establish connection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>transport</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>createTransport</span>(<span style=color:#a6e22e>serverProcess</span>, <span style=color:#a6e22e>serverConfig</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>connect</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>transport</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Discover available tools
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>discoverTools</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The <code>createTransport</code> method handles one of the client&rsquo;s core responsibilities: selecting the appropriate transport mechanism based on server type. This enables the protocol to work across different communication channels:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Creates either SSE or stdio transport based on server configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>createTransport</span>(<span style=color:#a6e22e>serverProcess</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>ChildProcess</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>, <span style=color:#a6e22e>serverConfig</span><span style=color:#f92672>?:</span> <span style=color:#a6e22e>any</span>)<span style=color:#f92672>:</span> Promise<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Transport</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>serverConfig</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;sse&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Create SSE transport for HTTP-based communication
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SSEClientTransport</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>serverConfig</span>.<span style=color:#a6e22e>url</span>));
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Create stdio transport for process-based communication
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>StdioClientTransport</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>command</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>serverConfig</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>command</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>args</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>serverConfig</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>args</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>process</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>serverProcess</span>
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>After establishing the connection, the client discovers what tools the server offers through the <code>discoverTools</code> method. This dynamic discovery approach is fundamental to MCP&rsquo;s flexibility, allowing clients to adapt to whatever capabilities servers provide:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Requests and stores the list of available tools from the server
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>discoverTools</span>()<span style=color:#f92672>:</span> Promise<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>void</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>toolsResponse</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>listTools</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tools</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>toolsResponse</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>tools</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>toolsResponse</span>.<span style=color:#a6e22e>tools</span> <span style=color:#f92672>:</span> [];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>`Discovered </span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tools</span>.<span style=color:#a6e22e>length</span><span style=color:#e6db74>}</span><span style=color:#e6db74> tools`</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The <code>callTool</code> method forms the core of client functionality, allowing the host to invoke server capabilities. It handles parameter validation, request formatting, and result processing:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Executes a tool with the provided arguments and processes the response
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#a6e22e>callTool</span>(<span style=color:#a6e22e>toolName</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>, <span style=color:#a6e22e>args</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Record</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>string</span>, <span style=color:#a6e22e>any</span><span style=color:#f92672>&gt;</span>)<span style=color:#f92672>:</span> Promise<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>string</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Verify tool exists
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>tool</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tools</span>.<span style=color:#a6e22e>find</span>(<span style=color:#a6e22e>t</span> =&gt; <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>toolName</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>tool</span>) <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>`Tool &#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>toolName</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34; not found`</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Call the tool on the server
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>callTool</span>({ <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>toolName</span>, <span style=color:#a6e22e>arguments</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>args</span> });
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Process and return the text content from the result
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>extractTextContent</span>(<span style=color:#a6e22e>result</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Finally, the <code>disconnect</code> method handles graceful shutdown, ensuring resources are properly released:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Gracefully terminates the connection and cleans up resources
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#a6e22e>disconnect</span>()<span style=color:#f92672>:</span> Promise<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>void</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span>) <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>transport</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isConnected</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Disconnected from server&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Through these methods, the client manages the complete lifecycle of server interaction, from connection establishment to discovery, execution, and termination. This structured approach ensures consistent communication patterns regardless of the underlying transport mechanism or server implementation.</p><h4 id=servers>Servers</h4><p>Servers provide the actual tools, resources, and prompts that enhance language model capabilities. Servers come in two primary types, each suited to different use cases:</p><ol><li><p><em>Stdio servers</em> use standard input/output streams for communication and run as local processes. These servers are spawned on demand by the host when a session begins and run as independent processes with their own lifecycle. They communicate with clients through stdin/stdout pipes, creating a direct channel for message exchange. When the session ends, stdio servers automatically terminate, ensuring resources are properly released. This approach provides perfect isolation between sessions since each client gets its own dedicated server process. The main limitation of stdio servers is that they&rsquo;re restricted to local execution, as they rely on process spawning within the same machine.</p><p>Here&rsquo;s how hosts like the MCP CLI spawn stdio servers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Spawn a stdio server process
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isSSE</span>) {
</span></span><span style=display:flex><span><span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>`Spawning stdio server using command: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>serverConfig</span>.<span style=color:#a6e22e>command</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>serverProcess</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>spawn</span>(<span style=color:#a6e22e>serverConfig</span>.<span style=color:#a6e22e>command</span>, <span style=color:#a6e22e>serverConfig</span>.<span style=color:#a6e22e>args</span> <span style=color:#f92672>||</span> [], {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>env</span><span style=color:#f92672>:</span> { ...<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>, ...<span style=color:#a6e22e>serverConfig</span>.<span style=color:#a6e22e>env</span> },
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>shell</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Forward server stderr output to client for debugging
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>serverProcess</span>.<span style=color:#a6e22e>stderr</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;data&#39;</span>, (<span style=color:#a6e22e>data</span>) =&gt; {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>toString</span>().<span style=color:#a6e22e>trim</span>();
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>message</span>) <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>`Server stderr: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Handle server process errors
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>serverProcess</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;error&#39;</span>, (<span style=color:#a6e22e>error</span>) =&gt; {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>`Server process error: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p><em>SSE servers</em> use HTTP-based Server-Sent Events for persistent connections. Unlike stdio servers, they run as long-lived services independent of client sessions and can manage multiple client connections concurrently. They communicate over HTTP, using SSE for server-to-client messages and standard HTTP requests for client-to-server communication. SSE servers require explicit startup and shutdown rather than being automatically spawned for each session. They can maintain state between client connections, making them suitable for applications that need persistent context. Their network-based approach allows them to support remote access, enabling clients to connect to servers running on different machines or in cloud environments.</p></li></ol><p>Stdio servers excel for simple, stateless tools like calculators or format converters, while SSE servers are better suited for stateful applications, multi-user systems, or remote services.</p><p>Part III will explore detailed server implementation strategies for both types.</p><h3 id=server-capabilities-tools-resources-and-prompts>Server capabilities: Tools, resources, and prompts</h3><p>MCP servers provide several distinct capabilities that extend language models in different ways. Each capability type serves a specific purpose in the architecture, with its own control pattern and integration approach.</p><ul><li><p><strong>Tools</strong> enable language models to perform actions and modify state within controlled boundaries. Similar to POST endpoints in a REST API, tools remain model-controlled—designed for discovery and usage by the language model itself (with appropriate user approval). Each tool has a unique name, descriptive guidance, and a JSON Schema defining its parameters.</p><p>A calculator server demonstrates this tool concept clearly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Example tool definition from calculator server
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>tool</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;add&#34;</span>,                           <span style=color:#75715e>// Tool name
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  { <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>z</span>.<span style=color:#a6e22e>number</span>(), <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>z</span>.<span style=color:#a6e22e>number</span>() }, <span style=color:#75715e>// Parameter schema using Zod
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>async</span> ({ <span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span> }) =&gt; {            <span style=color:#75715e>// Implementation function
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> [{ <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;text&#34;</span>, <span style=color:#a6e22e>text</span><span style=color:#f92672>:</span> String(<span style=color:#a6e22e>result</span>) }]
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><p>More complex tools handle file operations, API integrations, or database queries—extending the model&rsquo;s capabilities beyond text generation.</p></li><li><p><strong>Resources</strong> function as data sources that LLMs can access and incorporate as context. Similar to GET endpoints in a REST API, these read-only providers remain application-controlled—the client application determines how and when to utilize them. Each resource has a unique URI (e.g., <code>weather://london/current</code>) and can contain text or binary data with appropriate MIME types.</p><p>Resources extend beyond static files to include dynamic, real-time data. Servers can notify clients when resource content changes, creating a responsive context ecosystem.</p></li><li><p><strong>Prompts</strong> represent pre-defined templates that combine server data with structured formats to create consistent, contextually-appropriate content for the LLM. User-controlled rather than model-controlled, prompts are explicitly selected for specific purposes. Each prompt includes a name, description, optional arguments, and can incorporate embedded resources.</p><p>The most powerful MCP implementations combine these three offerings effectively. A file editor server might implement file content access as resources, file modification as tools, and code review as prompts—creating a system where each type of functionality plays to its strengths.</p></li></ul><h3 id=how-clients-and-servers-communicate>How clients and servers communicate</h3><p>MCP follows a structured protocol that defines how components communicate and interact throughout a complete connection lifecycle. This standardized approach ensures consistent behavior across different implementations and transport mechanisms.</p><p>The complete lifecycle follows this sequence:</p><pre tabindex=0><code>Client                                              Server
  |                                                   |
  |---------------initialize request-----------------&gt;|
  |                                                   |
  |&lt;--------------initialize response----------------|
  |                                                   |
  |---------------initialized notification----------&gt;|
  |                                                   |
  |                Connection ready                   |
  |                                                   |
  |----------------tools/list request---------------&gt;|
  |                                                   |
  |&lt;----------------tools list response--------------|
  |                                                   |
  |                  Tool discovery                   |
  |                                                   |
  |----------------tools/call request---------------&gt;|
  |                                                   |
  |&lt;-----------------tool execution result-----------|
  |                                                   |
  |                 Message exchange                  |
  |                                                   |
  |------------------shutdown request---------------&gt;|
  |                                                   |
  |&lt;------------------shutdown ack------------------|
  |                                                   |
  |                  Client disconnects               |
  |                                                   |
</code></pre><p>Let&rsquo;s examine each phase of this lifecycle in detail.</p><h4 id=initialization-and-discovery>Initialization and discovery</h4><p>Every MCP connection begins with a formal handshake sequence between client and server. This phase establishes compatibility and sets up the relationship before any actual work begins:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// From the McpClient class - Connection initialization
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#a6e22e>connect</span>(<span style=color:#a6e22e>serverProcess</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>ChildProcess</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>, <span style=color:#a6e22e>serverConfig</span><span style=color:#f92672>?:</span> <span style=color:#a6e22e>any</span>)<span style=color:#f92672>:</span> Promise<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>void</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Connecting to server...&#39;</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Create the appropriate transport based on server type
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>transport</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>createTransport</span>(<span style=color:#a6e22e>serverProcess</span>, <span style=color:#a6e22e>serverConfig</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. Initialize the client with the transport
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Client</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>transport</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. Send initialization request and establish connection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>initialize</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>protocolVersion</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;2024-11-05&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>capabilities</span><span style=color:#f92672>:</span> {},
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>clientInfo</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>name</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;1.0.0&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>timeout</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>60000</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 4. Connection established
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isConnected</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Connected to server!&#39;</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 5. Request available tools from the server
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>requestTools</span>();
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Failed to connect to server:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>error</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This initialization sequence serves several important purposes:</p><ul><li>It verifies protocol compatibility through version negotiation</li><li>It establishes capability expectations between client and server</li><li>It provides identification information for logging and troubleshooting</li></ul><p>Only after this handshake succeeds does the client request the list of available tools, resources, and prompts through standardized discovery methods:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Client-side tool discovery
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#a6e22e>requestTools</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>&#39;Requesting tools list...&#39;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>sendRequest</span>(<span style=color:#e6db74>&#39;tools/list&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tools</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>tools</span> <span style=color:#f92672>||</span> [];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>`Discovered </span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tools</span>.<span style=color:#a6e22e>length</span><span style=color:#e6db74>}</span><span style=color:#e6db74> tools`</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tools</span>;
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Failed to request tools:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>error</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=message-exchange>Message exchange</h4><p>Once the connection is established, MCP uses JSON-RPC 2.0 as its message format. Each request includes a method name, optional parameters, and a unique ID that correlates with its response:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#75715e>// Request format
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;jsonrpc&#34;</span>: <span style=color:#e6db74>&#34;2.0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;method&#34;</span>: <span style=color:#e6db74>&#34;tools/call&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;params&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;add&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;arguments&#34;</span>: { <span style=color:#f92672>&#34;a&#34;</span>: <span style=color:#ae81ff>5</span>, <span style=color:#f92672>&#34;b&#34;</span>: <span style=color:#ae81ff>7</span> }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Response format
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;jsonrpc&#34;</span>: <span style=color:#e6db74>&#34;2.0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;result&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;content&#34;</span>: [{ <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;text&#34;</span>, <span style=color:#f92672>&#34;text&#34;</span>: <span style=color:#e6db74>&#34;12&#34;</span> }]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The tool execution process showcases this pattern in action:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// From the McpClient class - Tool execution
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#a6e22e>callTool</span>(<span style=color:#a6e22e>toolName</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>, <span style=color:#a6e22e>args</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>any</span>)<span style=color:#f92672>:</span> Promise<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>any</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isConnected</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;Not connected to server&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>`Executing tool call: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>toolName</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Send the tool call request via the client
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>toolsCall</span>(<span style=color:#a6e22e>toolName</span>, <span style=color:#a6e22e>args</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>`Tool result:`</span>, <span style=color:#a6e22e>result</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>;
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>`Tool call failed: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>error</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=termination-process-client-disconnects>Termination process (client disconnects)</h4><p>The connection lifecycle concludes with a graceful termination sequence. This ensures all resources are properly released and both parties acknowledge the end of the session:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// From the McpClient class - Disconnection handling
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#a6e22e>disconnect</span>()<span style=color:#f92672>:</span> Promise<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>void</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isConnected</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Send a shutdown notification if we still have a connection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>shutdown</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Clean up resources
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>transport</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>transport</span>.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>transport</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>client</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isConnected</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tools</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Disconnected from server&#39;</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Error during disconnect:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Still mark as disconnected even if there was an error
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isConnected</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This complete connection lifecycle—initialization, discovery, message exchange, and termination—creates a predictable interaction pattern that both clients and servers can rely on.</p><p>In Part III, we&rsquo;ll move from this conceptual understanding to practical implementation details for MCP servers. We&rsquo;ll examine the specific transport mechanisms (stdio vs SSE), security considerations, error handling strategies, and design patterns for building robust systems that effectively extend language model capabilities.</p><h2 id=part-iii-how-to-implement-mcp-servers>Part III: How to implement MCP servers?</h2><p>Having explored the connection lifecycle and protocol flow in Part II, let&rsquo;s now examine how to implement these concepts in practical, production-ready code.</p><p>MCP supports two primary transport mechanisms: stdio for process-based communication and SSE for HTTP-based persistent connections. The choice between these options depends on specific application requirements:</p><p>When to use stdio transport:</p><ul><li>For stateless tools that don&rsquo;t need to maintain context between sessions</li><li>When security isolation between clients is critical</li><li>For simple use cases with minimal setup requirements</li><li>When automatic lifecycle management is preferred</li></ul><p>When to use SSE transport:</p><ul><li>For stateful applications that need to persist context across sessions</li><li>When serving multiple clients concurrently is important</li><li>For applications requiring remote access over networks</li><li>When integration with existing HTTP infrastructure is needed</li></ul><p>Now let&rsquo;s dive into how to implement each type of server.</p><h3 id=create-a-stdio-server>Create a stdio server</h3><p>Stdio transport creates a communication channel between client and server using standard input/output streams. When implementing a stdio server, it&rsquo;s important to understand how hosts interact with these servers. For stdio servers, the host takes complete responsibility for the server lifecycle - it spawns a new server process for each client connection, manages the communication channels, and terminates the process when the session ends.</p><p>This lifecycle management means stdio servers don&rsquo;t need to implement their own connection handling or session management. Instead, they simply need to create a transport, connect it to the server, and let the host handle the rest. This simplifies the server implementation but means the server runs as a new process for each client.</p><p>Here&rsquo;s the real implementation from the calculator stdio server. This calculator server implements four basic mathematical operations as tools. Each tool follows the same pattern: it accepts two numbers, performs an operation, and returns the result as text. Note that the division tool includes error handling for division by zero. The server initialization process is straightforward - it creates a stdio transport and connects it to the server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// From mcp-calculator-server/index.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>McpServer</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;@modelcontextprotocol/sdk/server/mcp.js&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>StdioServerTransport</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;@modelcontextprotocol/sdk/server/stdio.js&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>z</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;zod&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create a simple MCP server
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>server</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>McpServer</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Calculator Server&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;1.0.0&#34;</span>
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Add addition tool
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>tool</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;add&#34;</span>,
</span></span><span style=display:flex><span>  { <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>z</span>.<span style=color:#a6e22e>number</span>(), <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>z</span>.<span style=color:#a6e22e>number</span>() },
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> ({ <span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span> }) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> [{ <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;text&#34;</span>, <span style=color:#a6e22e>text</span><span style=color:#f92672>:</span> String(<span style=color:#a6e22e>result</span>) }]
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Truncated...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Add division tool
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>tool</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;divide&#34;</span>,
</span></span><span style=display:flex><span>  { <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>z</span>.<span style=color:#a6e22e>number</span>(), <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>z</span>.<span style=color:#a6e22e>number</span>() },
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> ({ <span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span> }) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>b</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#34;Cannot divide by zero&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> [{ <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;text&#34;</span>, <span style=color:#a6e22e>text</span><span style=color:#f92672>:</span> String(<span style=color:#a6e22e>result</span>) }]
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Start the server
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Create a transport
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>transport</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>StdioServerTransport</span>();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Connect the server to the transport
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>connect</span>(<span style=color:#a6e22e>transport</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Calculator MCP server running on stdio&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>main</span>().<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>error</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Fatal error in main():&#34;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>The stdio approach offers significant advantages for certain use cases. The process isolation creates natural security boundaries, with each client receiving a dedicated server instance. The automatic lifecycle management simplifies server administration—processes start when needed and terminate when the connection ends. Stdio transport also has minimal dependencies, making it easier to implement and deploy in various environments.</p><p>However, stdio transport has important limitations. The process-per-client model means each client gets its own server process, which prevents state persistence between different client sessions, though a single client can maintain context throughout its entire conversation.</p><p>One significant practical challenge with stdio servers is debugging. Since the stdout stream is used for protocol communication, you can&rsquo;t use standard console.log statements as they would interfere with the message exchange. Instead, developers must use alternative logging approaches such as writing to stderr (which doesn&rsquo;t interfere with the protocol) or logging to files:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Example of stdio-safe logging
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>message</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Log to stderr instead of stdout
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>`[DEBUG] </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Or write to a log file
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>appendFileSync</span>(<span style=color:#e6db74>&#39;server.log&#39;</span>, <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>()<span style=color:#e6db74>}</span><span style=color:#e6db74> - </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>\n`</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Usage in a tool
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>tool</span>(<span style=color:#e6db74>&#34;example&#34;</span>, { <span style=color:#a6e22e>input</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>z</span>.<span style=color:#a6e22e>string</span>() }, <span style=color:#66d9ef>async</span> ({ <span style=color:#a6e22e>input</span> }) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Processing input: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>input</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Process normally...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>});
</span></span></code></pre></div><p>This debugging limitation might seem minor, but it can significantly impact development workflow and error diagnosis in production environments.</p><h4 id=prevent-security-vulnerabilities>Prevent security vulnerabilities</h4><p>Security is critical in MCP servers, especially when handling file access or executing commands:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Path traversal prevention example
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>validateFilePath</span>(<span style=color:#a6e22e>requestedPath</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>, <span style=color:#a6e22e>allowedRoot</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Normalize to absolute path
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>absolutePath</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>isAbsolute</span>(<span style=color:#a6e22e>requestedPath</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>?</span> <span style=color:#a6e22e>requestedPath</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>:</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>join</span>(<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>cwd</span>(), <span style=color:#a6e22e>requestedPath</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Normalize to remove .. segments
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>normalizedPath</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>normalize</span>(<span style=color:#a6e22e>absolutePath</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Check if within allowed directory
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>normalizedPath</span>.<span style=color:#a6e22e>startsWith</span>(<span style=color:#a6e22e>allowedRoot</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>`Access denied: Path is outside allowed directory`</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>normalizedPath</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Example of secure file reading tool
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>tool</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;readFile&#34;</span>,
</span></span><span style=display:flex><span>  { <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>z</span>.<span style=color:#a6e22e>string</span>() },
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> ({ <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>filePath</span> }) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Validate path before using
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>validatedPath</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>validateFilePath</span>(<span style=color:#a6e22e>filePath</span>, <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>cwd</span>());
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Read file only after validation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>promises</span>.<span style=color:#a6e22e>readFile</span>(<span style=color:#a6e22e>validatedPath</span>, <span style=color:#e6db74>&#39;utf8&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> [{ <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;text&#34;</span>, <span style=color:#a6e22e>text</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>content</span> }] };
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> [{ <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;text&#34;</span>, <span style=color:#a6e22e>text</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`Error: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span> }],
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>isError</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><p>This implementation prevents path traversal attacks by validating that requested paths stay within allowed directories. Similar precautions should be taken for any operation that accesses external resources.</p><h3 id=create-an-sse-server>Create an SSE Server</h3><p>Unlike stdio servers where hosts manage the complete lifecycle, SSE servers operate independently of the host. When implementing an SSE server, the server itself is responsible for maintaining its own lifecycle, handling multiple client connections concurrently, and managing session state. The host simply connects to the server&rsquo;s HTTP endpoint and communicates via the SSE protocol.</p><p>This means SSE servers must implement their own connection management, session tracking, and communication handling. They typically run continuously as standalone services, waiting for clients to connect. Hosts don&rsquo;t spawn or terminate SSE servers - instead, they discover and connect to existing server endpoints.</p><p>An SSE server uses HTTP to handle connections and message exchange. Here&rsquo;s the real implementation from the calculator SSE server.</p><p>The calculator SSE server implements the same four mathematical operations as tools, but with a significantly different transport implementation. It uses Express.js to create an HTTP server with two main endpoints:</p><ol><li>A GET endpoint at <code>/sse</code> that establishes the SSE connection and creates a transport for each client</li><li>A POST endpoint at <code>/messages</code> that receives JSON-RPC messages from clients</li></ol><p>The server maintains a map of active transports indexed by session ID, creating a new transport for each client connection and removing it when the connection closes. This session management is a key difference from stdio servers, allowing the SSE server to handle multiple concurrent clients.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// From mcp-calculator-sse-server/index.js
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>McpServer</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;@modelcontextprotocol/sdk/server/mcp.js&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>SSEServerTransport</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;@modelcontextprotocol/sdk/server/sse.js&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>express</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;express&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>cors</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;cors&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>z</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;zod&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>cors</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>json</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Add request logging
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>((<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>next</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>()<span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>method</span><span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>url</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>next</span>();
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PORT</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>PORT</span> <span style=color:#f92672>||</span> <span style=color:#ae81ff>3000</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>NAME</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Calculator Server&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>VERSION</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;1.0.0&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create a simple MCP server
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>server</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>McpServer</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>NAME</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>VERSION</span>
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Add addition tool
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>tool</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;add&#34;</span>,
</span></span><span style=display:flex><span>  { <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>z</span>.<span style=color:#a6e22e>number</span>(), <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>z</span>.<span style=color:#a6e22e>number</span>() },
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> ({ <span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span> }) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> [{ <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;text&#34;</span>, <span style=color:#a6e22e>text</span><span style=color:#f92672>:</span> String(<span style=color:#a6e22e>result</span>) }]
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Truncated...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Add division tool
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>tool</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;divide&#34;</span>,
</span></span><span style=display:flex><span>  { <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>z</span>.<span style=color:#a6e22e>number</span>(), <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>z</span>.<span style=color:#a6e22e>number</span>() },
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> ({ <span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span> }) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>b</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#34;Cannot divide by zero&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>b</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> [{ <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;text&#34;</span>, <span style=color:#a6e22e>text</span><span style=color:#f92672>:</span> String(<span style=color:#a6e22e>result</span>) }]
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Store active transports by session ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>activeTransports</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Map</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// SSE endpoint handler
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/sse&#39;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;SSE connection attempt received&#39;</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Create SSE transport for this connection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>transport</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SSEServerTransport</span>(<span style=color:#e6db74>&#39;/messages&#39;</span>, <span style=color:#a6e22e>res</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sessionId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>query</span>.<span style=color:#a6e22e>sessionId</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>transport</span>.<span style=color:#a6e22e>sessionId</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Created transport with session ID: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>sessionId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Store the transport
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>activeTransports</span>.<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>sessionId</span>, <span style=color:#a6e22e>transport</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Clean up on connection close
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;close&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Cleaning up transport for session </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>sessionId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>activeTransports</span>.<span style=color:#66d9ef>delete</span>(<span style=color:#a6e22e>sessionId</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Connect transport to server
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>connect</span>(<span style=color:#a6e22e>transport</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Server connected to SSE transport&#39;</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Error connecting transport:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>headersSent</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>500</span>).<span style=color:#a6e22e>end</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Handle messages
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#39;/messages&#39;</span>, <span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>json</span>(), <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sessionId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>query</span>.<span style=color:#a6e22e>sessionId</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Received SSE client message for session </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>sessionId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>:`</span>, <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Get the transport for this session
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>transport</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>activeTransports</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>sessionId</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>transport</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>`No active transport found for session </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>sessionId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Let the transport handle the message routing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>transport</span>.<span style=color:#a6e22e>handleMessage</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>(<span style=color:#a6e22e>response</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Error handling SSE client message:&#39;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>500</span>).<span style=color:#a6e22e>json</span>({ <span style=color:#a6e22e>error</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span> });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Start the server
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#a6e22e>PORT</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Calculator MCP server running on http://localhost:</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>PORT</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Server is running. Press Ctrl+C to stop.&#34;</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Handle process termination
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;SIGINT&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Received SIGINT. Shutting down...&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;SIGTERM&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Received SIGTERM. Shutting down...&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>main</span>().<span style=color:#66d9ef>catch</span>((<span style=color:#a6e22e>error</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Fatal error in main():&#34;</span>, <span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>The SSE approach offers several compelling advantages for certain applications. The HTTP-based communication enables remote accessibility, allowing clients to connect to servers running on different machines or in cloud environments. SSE servers can also handle multiple concurrent connections through a single server process, which can be more resource-efficient than spawning separate processes for each client.</p><p>However, these benefits come with significant additional complexity, especially in production environments. The example shown stores session transports in an in-memory Map:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Store active transports by session ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>activeTransports</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Map</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Store the transport
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>activeTransports</span>.<span style=color:#a6e22e>set</span>(<span style=color:#a6e22e>sessionId</span>, <span style=color:#a6e22e>transport</span>);
</span></span></code></pre></div><p>This approach, while simple for demonstration purposes, is not production-ready. In a real-world deployment, in-memory storage fails when scaling to multiple server instances behind a load balancer, doesn&rsquo;t persist across server restarts, and risks memory leaks if connections aren&rsquo;t properly cleaned up. For production use, you would need an external session storage solution like Redis to maintain transport and session information across multiple server instances, ensuring clients can reconnect even if they&rsquo;re load-balanced to a different server or if the original server restarts.</p><p>The HTTP dependencies also introduce additional requirements for deployment and configuration. The persistent nature of SSE servers means they must be started and stopped explicitly rather than spawning automatically when needed, adding operational complexity.</p><h3 id=sse-server-lifecycle>SSE server lifecycle</h3><p>Unlike stdio servers that are automatically managed by the host, SSE servers require explicit lifecycle management. Here&rsquo;s how to manage an SSE server using the MCP CLI:</p><ol><li><p>Start the server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>❯ mcp server start calculator-sse -d
</span></span><span style=display:flex><span>2025-03-17T06:42:23.153Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> server: Server calculator-sse started successfully <span style=color:#f92672>(</span>PID: 43687<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>✔ Server calculator-sse started successfully <span style=color:#f92672>(</span>PID: 43687<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Server is running in the background.
</span></span><span style=display:flex><span>Server logs are being written to /Users/dos/mcp/logs/server-calculator-sse.log
</span></span><span style=display:flex><span>To stop the server, run: mcp server stop calculator-sse
</span></span><span style=display:flex><span>To chat with the server, run: mcp chat --server calculator-sse
</span></span></code></pre></div></li><li><p>Send a query to the server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>❯ echo <span style=color:#e6db74>&#34;what is 20+22?&#34;</span> | mcp chat -s calculator-sse -d
</span></span><span style=display:flex><span>2025-03-17T06:42:34.078Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:calculator-sse: Creating MCP client: calculator-sse <span style=color:#f92672>(</span>MCP Client <span style=color:#f92672>(</span>calculator-sse<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>2025-03-17T06:42:34.079Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:calculator-sse: Creating MCP client...
</span></span><span style=display:flex><span>2025-03-17T06:42:34.079Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:calculator-sse: Server process:
</span></span><span style=display:flex><span>2025-03-17T06:42:34.079Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:calculator-sse: Creating transport...
</span></span><span style=display:flex><span>2025-03-17T06:42:34.079Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:calculator-sse: Using SSE transport with URL: http://localhost:3000
</span></span><span style=display:flex><span>2025-03-17T06:42:35.081Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:calculator-sse: Transport created successfully
</span></span><span style=display:flex><span>2025-03-17T06:42:35.083Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:calculator-sse: Connecting to server...
</span></span><span style=display:flex><span>2025-03-17T06:42:35.145Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:calculator-sse: Connected to server!
</span></span><span style=display:flex><span>2025-03-17T06:42:35.145Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:calculator-sse: Requesting tools list...
</span></span><span style=display:flex><span>2025-03-17T06:42:35.149Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:calculator-sse: Raw tools response: <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;tools&#34;</span>:<span style=color:#f92672>[{</span><span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;add&#34;</span>,<span style=color:#e6db74>&#34;inputSchema&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;object&#34;</span>,<span style=color:#e6db74>&#34;properties&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;a&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;number&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;b&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;number&#34;</span><span style=color:#f92672>}}</span>,<span style=color:#e6db74>&#34;required&#34;</span>:<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;a&#34;</span>,<span style=color:#e6db74>&#34;b&#34;</span><span style=color:#f92672>]</span>,<span style=color:#e6db74>&#34;additionalProperties&#34;</span>:false,<span style=color:#e6db74>&#34;</span>$schema<span style=color:#e6db74>&#34;</span>:<span style=color:#e6db74>&#34;http://json-schema.org/draft-07/schema#&#34;</span><span style=color:#f92672>}}</span>,<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;subtract&#34;</span>,<span style=color:#e6db74>&#34;inputSchema&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;object&#34;</span>,<span style=color:#e6db74>&#34;properties&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;a&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;number&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;b&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;number&#34;</span><span style=color:#f92672>}}</span>,<span style=color:#e6db74>&#34;required&#34;</span>:<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;a&#34;</span>,<span style=color:#e6db74>&#34;b&#34;</span><span style=color:#f92672>]</span>,<span style=color:#e6db74>&#34;additionalProperties&#34;</span>:false,<span style=color:#e6db74>&#34;</span>$schema<span style=color:#e6db74>&#34;</span>:<span style=color:#e6db74>&#34;http://json-schema.org/draft-07/schema#&#34;</span><span style=color:#f92672>}}</span>,<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;multiply&#34;</span>,<span style=color:#e6db74>&#34;inputSchema&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;object&#34;</span>,<span style=color:#e6db74>&#34;properties&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;a&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;number&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;b&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;number&#34;</span><span style=color:#f92672>}}</span>,<span style=color:#e6db74>&#34;required&#34;</span>:<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;a&#34;</span>,<span style=color:#e6db74>&#34;b&#34;</span><span style=color:#f92672>]</span>,<span style=color:#e6db74>&#34;additionalProperties&#34;</span>:false,<span style=color:#e6db74>&#34;</span>$schema<span style=color:#e6db74>&#34;</span>:<span style=color:#e6db74>&#34;http://json-schema.org/draft-07/schema#&#34;</span><span style=color:#f92672>}}</span>,<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;divide&#34;</span>,<span style=color:#e6db74>&#34;inputSchema&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;object&#34;</span>,<span style=color:#e6db74>&#34;properties&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;a&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;number&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;b&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;number&#34;</span><span style=color:#f92672>}}</span>,<span style=color:#e6db74>&#34;required&#34;</span>:<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;a&#34;</span>,<span style=color:#e6db74>&#34;b&#34;</span><span style=color:#f92672>]</span>,<span style=color:#e6db74>&#34;additionalProperties&#34;</span>:false,<span style=color:#e6db74>&#34;</span>$schema<span style=color:#e6db74>&#34;</span>:<span style=color:#e6db74>&#34;http://json-schema.org/draft-07/schema#&#34;</span><span style=color:#f92672>}}]}</span>
</span></span><span style=display:flex><span>2025-03-17T06:42:35.149Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:calculator-sse: Discovered <span style=color:#ae81ff>4</span> tools
</span></span><span style=display:flex><span>2025-03-17T06:42:35.150Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:calculator-sse: Available tools: add, subtract, multiply, divide
</span></span><span style=display:flex><span>2025-03-17T06:42:35.150Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> host:chat: Starting chat session with server: calculator-sse
</span></span><span style=display:flex><span>2025-03-17T06:42:35.150Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> host:chat: Starting non-interactive chat session <span style=color:#f92672>(</span>piped input<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2025-03-17T06:42:35.151Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> host:chat: Processing piped query:
</span></span><span style=display:flex><span>2025-03-17T06:42:35.151Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:calculator-sse: Processing query: what is 20+22?
</span></span><span style=display:flex><span>2025-03-17T06:42:35.152Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:calculator-sse: Available tools:
</span></span><span style=display:flex><span>2025-03-17T06:42:38.602Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:calculator-sse: Executing tool call: add
</span></span><span style=display:flex><span>2025-03-17T06:42:38.602Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:calculator-sse: Calling tool <span style=color:#e6db74>&#34;add&#34;</span> with args:
</span></span><span style=display:flex><span>2025-03-17T06:42:38.609Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> client:calculator-sse: Tool result: <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>20</span> + 22 <span style=color:#f92672>=</span> <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span>2025-03-17T06:42:39.412Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> host:chat: Disconnecting client during shutdown
</span></span><span style=display:flex><span>2025-03-17T06:42:39.412Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:calculator-sse: Disconnecting from server
</span></span><span style=display:flex><span>2025-03-17T06:42:39.414Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  client:calculator-sse: Disconnected from server
</span></span><span style=display:flex><span>2025-03-17T06:42:39.414Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> host:chat: Chat session ended
</span></span></code></pre></div></li><li><p>Check server logs.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>❯ cat ~/mcp/logs/server-calculator-sse.log
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>2025-03-17T06:42:23.138Z<span style=color:#f92672>]</span> <span style=color:#f92672>===</span> SERVER START <span style=color:#f92672>===</span>
</span></span><span style=display:flex><span>Command: node /Users/dos/Desktop/mcp/mcp-servers/mcp-calculator-sse-server/index.js
</span></span><span style=display:flex><span>Working directory: /Users/dos/Desktop/mcp/mcp-servers/mcp-calculator-sse-server
</span></span><span style=display:flex><span>Type: sse
</span></span><span style=display:flex><span>URL: http://localhost:3000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Calculator MCP server running on http://localhost:3000
</span></span><span style=display:flex><span>Server is running. Press Ctrl+C to stop.
</span></span><span style=display:flex><span>Available endpoints:
</span></span><span style=display:flex><span>  - GET / <span style=color:#f92672>(</span>SSE endpoint<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  - POST * <span style=color:#f92672>(</span>message endpoint<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Registered route: get /*
</span></span><span style=display:flex><span>Registered route: post *
</span></span><span style=display:flex><span>2025-03-17T06:42:35.119Z GET /
</span></span><span style=display:flex><span>SSE connection attempt received
</span></span><span style=display:flex><span>Created transport with session ID: 55984849-ee5e-4f65-bace-fc45d0d398fa
</span></span><span style=display:flex><span>Server connected to SSE transport
</span></span><span style=display:flex><span>2025-03-17T06:42:35.138Z POST /messages?sessionId<span style=color:#f92672>=</span>55984849-ee5e-4f65-bace-fc45d0d398fa
</span></span><span style=display:flex><span>Received SSE client message <span style=color:#66d9ef>for</span> session 55984849-ee5e-4f65-bace-fc45d0d398fa: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  method: <span style=color:#e6db74>&#39;initialize&#39;</span>,
</span></span><span style=display:flex><span>  params: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    protocolVersion: <span style=color:#e6db74>&#39;2024-11-05&#39;</span>,
</span></span><span style=display:flex><span>    capabilities: <span style=color:#f92672>{}</span>,
</span></span><span style=display:flex><span>    clientInfo: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      name: <span style=color:#e6db74>&#39;MCP Client (calculator-sse)&#39;</span>,
</span></span><span style=display:flex><span>      version: <span style=color:#e6db74>&#39;1.0.0&#39;</span>,
</span></span><span style=display:flex><span>      timeout: <span style=color:#ae81ff>60000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  jsonrpc: <span style=color:#e6db74>&#39;2.0&#39;</span>,
</span></span><span style=display:flex><span>  id: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>2025-03-17T06:42:35.144Z POST /messages?sessionId<span style=color:#f92672>=</span>55984849-ee5e-4f65-bace-fc45d0d398fa
</span></span><span style=display:flex><span>Received SSE client message <span style=color:#66d9ef>for</span> session 55984849-ee5e-4f65-bace-fc45d0d398fa: <span style=color:#f92672>{</span> method: <span style=color:#e6db74>&#39;notifications/initialized&#39;</span>, jsonrpc: <span style=color:#e6db74>&#39;2.0&#39;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>2025-03-17T06:42:35.147Z POST /messages?sessionId<span style=color:#f92672>=</span>55984849-ee5e-4f65-bace-fc45d0d398fa
</span></span><span style=display:flex><span>Received SSE client message <span style=color:#66d9ef>for</span> session 55984849-ee5e-4f65-bace-fc45d0d398fa: <span style=color:#f92672>{</span> method: <span style=color:#e6db74>&#39;tools/list&#39;</span>, jsonrpc: <span style=color:#e6db74>&#39;2.0&#39;</span>, id: <span style=color:#ae81ff>1</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>2025-03-17T06:42:38.607Z POST /messages?sessionId<span style=color:#f92672>=</span>55984849-ee5e-4f65-bace-fc45d0d398fa
</span></span><span style=display:flex><span>Received SSE client message <span style=color:#66d9ef>for</span> session 55984849-ee5e-4f65-bace-fc45d0d398fa: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  method: <span style=color:#e6db74>&#39;tools/call&#39;</span>,
</span></span><span style=display:flex><span>  params: <span style=color:#f92672>{</span> name: <span style=color:#e6db74>&#39;add&#39;</span>, arguments: <span style=color:#f92672>{</span> a: 20, b: <span style=color:#ae81ff>22</span> <span style=color:#f92672>}</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  jsonrpc: <span style=color:#e6db74>&#39;2.0&#39;</span>,
</span></span><span style=display:flex><span>  id: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>Cleaning up transport <span style=color:#66d9ef>for</span> session 55984849-ee5e-4f65-bace-fc45d0d398fa
</span></span></code></pre></div></li><li><p>Stop the server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>❯ mcp server stop calculator-sse -d
</span></span><span style=display:flex><span>⠦ Stopping server...2025-03-17T06:46:06.873Z <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  server: Process <span style=color:#ae81ff>43871</span> was successfully terminated
</span></span><span style=display:flex><span>2025-03-17T06:46:06.891Z <span style=color:#f92672>[</span>DEBUG<span style=color:#f92672>]</span> server: Server <span style=color:#e6db74>&#34;calculator-sse&#34;</span> stopped successfully
</span></span><span style=display:flex><span>✔ Server <span style=color:#e6db74>&#34;calculator-sse&#34;</span> stopped successfully.
</span></span></code></pre></div></li></ol><p>This explicit lifecycle management is a key difference from stdio servers, which are automatically created and destroyed for each client connection. With SSE servers, you&rsquo;re responsible for starting the server before clients can connect to it and stopping it when it&rsquo;s no longer needed.</p><h2 id=conclusion>Conclusion</h2><p>The field of MCP implementation continues to evolve, with ongoing developments in:</p><ul><li>Authentication and access control</li><li>Real-time streaming capabilities</li><li>Cross-server federation</li><li>Standardized testing frameworks</li></ul><p>By building on the patterns and practices described here, you can create robust, secure, and scalable MCP servers that extend language models with specialized capabilities while maintaining the flexibility to adapt as the protocol evolves.</p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#mcp-cli-and-mcp-servers>MCP CLI and <code>mcp-servers</code></a></li><li><a href=#part-i-what-problems-do-mcps-solve>Part I: What problems do MCPs solve?</a></li><li><a href=#part-ii-how-does-mcp-work>Part II: How does MCP work?</a><ul><li><a href=#core-components-hosts-clients-and-servers>Core components: Hosts, clients, and servers</a></li><li><a href=#server-capabilities-tools-resources-and-prompts>Server capabilities: Tools, resources, and prompts</a></li><li><a href=#how-clients-and-servers-communicate>How clients and servers communicate</a></li></ul></li><li><a href=#part-iii-how-to-implement-mcp-servers>Part III: How to implement MCP servers?</a><ul><li><a href=#create-a-stdio-server>Create a stdio server</a></li><li><a href=#create-an-sse-server>Create an SSE Server</a></li><li><a href=#sse-server-lifecycle>SSE server lifecycle</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&text=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&title=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&is_video=false&description=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up&body=Check out this article: http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&title=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&title=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&name=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up&description=%3cp%3eLarge%20language%20models%20%28LLMs%29%20have%20changed%20how%20we%20interact%20with%20artificial%20intelligence%2c%20enabling%20natural%20conversations%20and%20complex%20reasoning.%20Yet%20these%20powerful%20models%20have%20a%20fundamental%20limitation%3a%20they%26rsquo%3bre%20constrained%20by%20the%20context%20available%20during%20each%20interaction.%20Without%20access%20to%20real-time%20information%2c%20private%20data%20sources%2c%20or%20the%20ability%20to%20take%20actions%2c%20LLMs%20remain%20sophisticated%20but%20isolated%20systems.%3c%2fp%3e%0a%3cp%3eModel%20context%20protocol%20%28MCP%29%20tackles%20this%20limitation%20by%20creating%20standardized%20interfaces%20between%20LLMs%20and%20external%20systems.%20Similar%20to%20how%20APIs%20transformed%20web%20development%20by%20connecting%20different%20services%2c%20MCPs%20create%20clear%20pathways%20for%20language%20models%20to%20access%20tools%2c%20retrieve%20information%2c%20and%20perform%20actions%20based%20on%20user%20requests.%20This%20standardization%20does%20more%20than%20just%20add%20convenience.%20By%20separating%20model%20providers%20from%20tool%20creators%2c%20MCPs%20foster%20an%20ecosystem%20where%20specialized%20capabilities%20can%20be%20developed%20independently%20yet%20work%20together%20seamlessly.%20This%20approach%20solves%20the%20fragmentation%20problem%20in%20AI%20tool%20integration%2c%20where%20each%20model%20provider%20currently%20uses%20unique%20and%20incompatible%20connection%20methods.%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=http%3a%2f%2fim2nguyen.com%2fposts%2fexploring-mcp-from-ground-up%2f&t=Exploring%20Model%20Context%20Protocol%20%28MCP%29%20from%20the%20ground%20up" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2025 im2nguyen</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script></html>